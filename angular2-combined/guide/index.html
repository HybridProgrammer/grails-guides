<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
    <head>
        <title>Combining the Angular 2 Profile Projects</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />
        <link rel="stylesheet" href="../css/guide.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />        
        <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8" />

        <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.5.13/clipboard.min.js"></script>
    <script type="text/javascript">
function addJsClass(el) {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
    </head>

    <body class="body" onload="addJsClass();">
        <div id="navigation">
            <div class="navTitle">
                
                Grails Framework Guide 
            </div>
            <div class="navLinks">
                <ul>
                    <li>
                        <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                            <a href="../guide/index.html" class="button">Table of contents</a>
                            <div id="nav-summary-childs" style="display:none;">
                                
                                <div class="toc-item" style="margin-left:0"><a href="#gettingStarted"><strong>1</strong><span>Getting Started</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#writingTheApp"><strong>2</strong><span>Writing the Application</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#runningTheApp"><strong>3</strong><span>Running the Application</span></a></div>
                                
                            </div>
                        </div>
                    </li>
                </ul>

            </div>
        </div>


        <table id="colset" border="0" cellpadding="0" cellspacing="0">
            <tr>
                <td id="col1">
                    <div id="main" class="corner-all">

                        <div class="project">
                            <h1>Combining the Angular 2 Profile Projects</h1>
                            <p></p>
                            <p>This guide will take you through the process of creating a single build starting with the Angular 2 profile.</p>
                            <p><strong>Authors:</strong> James Kleeh</p>
                            <p><strong>Grails Version:</strong> 3.2.3</p>
                            
                        </div>

                        

<h1 id="gettingStarted">1 Getting Started</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/angular2-combined/edit/master/src/main/docs/guide/gettingStarted.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The Angular 2 profile in Grails 3 provides a multi project build out of the box. Today there are many options for how to build and package your applications. It is important to decide for yourself what is best for your needs. For those who prefer to have the client side application bundled together with their Grails application, this guide is for you. In this guide I will cover some quick simple steps to get up and running with a combined project starting from the multi project build created from the Angular 2 profile.</p>
</div>


<h2 id="requirements">1.1 What you will need</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/angular2-combined/edit/master/src/main/docs/guide/requirements.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To complete this guide you will need the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Some time on your hands</p>
</li>
<li>
<p>A decent text editor or IDE</p>
</li>
<li>
<p>JDK 1.7 or greater installed with <code>JAVA_HOME</code> configured appropriately</p>
</li>
</ul>
</div>


<h2 id="howto">1.2 How to complete the guide</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/angular2-combined/edit/master/src/main/docs/guide/howto.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To complete this guide you will need to checkout the source from Github and work through the steps presented by the guide.</p>
</div>
<div class="paragraph">
<p>To get started do the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/grails-guides/angular2-combined/archive/master.zip">Download</a> and unzip the source or if you already have <a href="https://git-scm.com/">Git</a>: <code>git clone <a href="https://github.com/grails-guides/angular2-combined.git" class="bare">https://github.com/grails-guides/angular2-combined.git</a></code></p>
</li>
<li>
<p><code>cd</code> into <code>grails-guides/angular2-combined/initial</code></p>
</li>
<li>
<p>Head on over to the next section</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can go right to the completed example if you <code>cd</code> into <code>grails-guides/angular2-combined/complete</code>
</td>
</tr>
</table>
</div>


<h1 id="writingTheApp">2 Writing the Application</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/angular2-combined/edit/master/src/main/docs/guide/writingTheApp.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>





<h2 id="combining">2.1 Combining the Applications</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/angular2-combined/edit/master/src/main/docs/guide/combining.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Since a single project is desired, the <code>settings.gradle</code> file is no longer necessary.</p>
</div>
<div class="paragraph">
<p><code>rm -f settings.gradle</code></p>
</div>
<div class="paragraph">
<p>Move all of the contents of <code>server</code> to the current directory</p>
</div>
<div class="paragraph">
<p><code>mv server/* ./</code></p>
</div>
<div class="paragraph">
<p>Delete the <code>server</code> directory</p>
</div>
<div class="paragraph">
<p><code>rm -r server</code></p>
</div>
<div class="paragraph">
<p>Move the <code>client</code> directory to the <code>src/main</code> directory</p>
</div>
<div class="paragraph">
<p><code>mv client src/main/</code></p>
</div>
<div class="paragraph">
<p>Delete the no longer used <code>build.gradle</code> file in the client directory</p>
</div>
<div class="paragraph">
<p><code>rm -f src/main/client/build.gradle</code></p>
</div>
<div class="paragraph">
<p>Now you have a single Grails project with the client side application living in <code>src/main/client</code>!</p>
</div>


<h2 id="build">2.2 Combining the Builds</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/angular2-combined/edit/master/src/main/docs/guide/build.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>It would be ideal if the application would just "work" by executing <code>run-app</code> similar to how typical Grails applications with the web profile do. In order to achieve that, additional configuration is required.</p>
</div>
<div class="paragraph">
<p>To support the build process, first we need to add some NPM scripts. Add the following to the <code>package.json</code> file.</p>
</div>
<div class="listingblock">
<div class="title">src/main/client/package.json</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="error">.</span><span class="error">.</span><span class="error">.</span>
  <span class="key"><span class="delimiter">&quot;</span><span class="content">scripts</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">build</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ng build --prod</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">buildDev</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ng build</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">buildWatch</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ng build --watch=true</span><span class="delimiter">&quot;</span></span>,
  <span class="error">.</span><span class="error">.</span><span class="error">.</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The next step is to add the <a href="https://github.com/srs/gradle-node-plugin">Gradle Node Plugin</a>.</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">buildscript {
    dependencies {
        classpath <span class="string"><span class="delimiter">&quot;</span><span class="content">com.moowork.gradle:gradle-node-plugin:1.0.1</span><span class="delimiter">&quot;</span></span>
    }
}

apply <span class="key">plugin</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">com.moowork.node</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now that we have the plugin, we need to configure it and use it to create some tasks to hook into the build process of the Grails application.</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">node {
    version = <span class="string"><span class="delimiter">'</span><span class="content">6.9.1</span><span class="delimiter">'</span></span>
    download = <span class="predefined-constant">true</span>
    nodeModulesDir = file(<span class="string"><span class="delimiter">&quot;</span><span class="content">src/main/client</span><span class="delimiter">&quot;</span></span>)
}

task buildClientDev(<span class="key">type</span>: NpmTask, <span class="key">dependsOn</span>: <span class="string"><span class="delimiter">'</span><span class="content">npmInstall</span><span class="delimiter">'</span></span>) {
    group = <span class="string"><span class="delimiter">'</span><span class="content">build</span><span class="delimiter">'</span></span>
    description = <span class="string"><span class="delimiter">'</span><span class="content">Compile client side assets for development</span><span class="delimiter">'</span></span>
    args = [<span class="string"><span class="delimiter">'</span><span class="content">run</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">buildDev</span><span class="delimiter">'</span></span>]
}

task buildClient(<span class="key">type</span>: NpmTask, <span class="key">dependsOn</span>: <span class="string"><span class="delimiter">'</span><span class="content">npmInstall</span><span class="delimiter">'</span></span>) {
    group = <span class="string"><span class="delimiter">'</span><span class="content">build</span><span class="delimiter">'</span></span>
    description = <span class="string"><span class="delimiter">'</span><span class="content">Compile client side assets for production</span><span class="delimiter">'</span></span>
    args = [<span class="string"><span class="delimiter">'</span><span class="content">run</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">build</span><span class="delimiter">'</span></span>]
}

task buildClientWatch(<span class="key">type</span>: NpmTask, <span class="key">dependsOn</span>: <span class="string"><span class="delimiter">'</span><span class="content">npmInstall</span><span class="delimiter">'</span></span>) {
    group = <span class="string"><span class="delimiter">'</span><span class="content">application</span><span class="delimiter">'</span></span>
    description = <span class="string"><span class="delimiter">'</span><span class="content">Builds and watches the client side assets for rebuilding</span><span class="delimiter">'</span></span>
    args = [<span class="string"><span class="delimiter">'</span><span class="content">run</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">buildWatch</span><span class="delimiter">'</span></span>]
}

task clientTest(<span class="key">type</span>: NpmTask, <span class="key">dependsOn</span>: <span class="string"><span class="delimiter">'</span><span class="content">npmInstall</span><span class="delimiter">'</span></span>) {
    group = <span class="string"><span class="delimiter">'</span><span class="content">verification</span><span class="delimiter">'</span></span>
    description = <span class="string"><span class="delimiter">'</span><span class="content">Executes client side unit tests</span><span class="delimiter">'</span></span>
    args = [<span class="string"><span class="delimiter">'</span><span class="content">run</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">test</span><span class="delimiter">'</span></span>]
}

task clientIntegrationTest(<span class="key">type</span>: NpmTask, <span class="key">dependsOn</span>: <span class="string"><span class="delimiter">'</span><span class="content">npmInstall</span><span class="delimiter">'</span></span>) {
    group = <span class="string"><span class="delimiter">'</span><span class="content">verification</span><span class="delimiter">'</span></span>
    description = <span class="string"><span class="delimiter">'</span><span class="content">Executes client side integration tests</span><span class="delimiter">'</span></span>
    args = [<span class="string"><span class="delimiter">'</span><span class="content">run</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">e2e</span><span class="delimiter">'</span></span>]
}

bootRun.dependsOn(buildClientDev)

war.dependsOn(buildClient)

test.dependsOn(clientTest)

integrationTest.dependsOn(clientIntegrationTest)

clean {
    delete fileTree(<span class="key">dir</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">src/main/webapp</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>


<h2 id="configuration">2.3 Changing Configuration</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/angular2-combined/edit/master/src/main/docs/guide/configuration.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>We need to change where the client side assets will be stored after they are built and bundled. Modify the <code>apps.outDir</code> setting to point to the <code>webapp</code> folder.</p>
</div>
<div class="listingblock">
<div class="title">src/main/client/angular-cli.json</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"><span class="error">.</span><span class="error">.</span><span class="error">.</span>
  <span class="key"><span class="delimiter">&quot;</span><span class="content">apps</span><span class="delimiter">&quot;</span></span>: [
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">root</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">src</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">outDir</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">../webapp</span><span class="delimiter">&quot;</span></span>,
<span class="error">.</span><span class="error">.</span><span class="error">.</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Because CORS is no longer a requirement of this application, it should be turned off in configuration. Find <code>grails.cors.enabled</code> and remove the configuration or set it to false.</p>
</div>
<div class="listingblock">
<div class="title">grails-app/conf/application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">grails</span>:
    <span class="key">cors</span>:
        <span class="key">enabled</span>: <span class="string"><span class="content">false</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to resolve our <code>index.html</code> without the <code>/static</code> prefix, it is necessary to set the resources pattern.</p>
</div>
<div class="listingblock">
<div class="title">grails-app/conf/application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">grails</span>:
    <span class="key">resources</span>:
        <span class="key">pattern</span>: <span class="string"><span class="content">/**</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When a user vists your page, it should direct them to the client side application. By default in a rest-api application, it will show some metadata about your application. To change that behavior, modify <code>UrlMappings.groovy</code>.</p>
</div>
<div class="listingblock">
<div class="title">grails-app/controllers/angular2/combined/UrlMappings.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="error">&quot;/&quot;(uri</span>: <span class="error">&quot;/index.html&quot;)</span></code></pre>
</div>
</div>


<h1 id="runningTheApp">3 Running the Application</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/angular2-combined/edit/master/src/main/docs/guide/runningTheApp.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>That is everything required to combine the Angular 2 multi project build into a single project.</p>
</div>
<div class="paragraph">
<p>To run the application use the <code>./gradlew bootRun</code> command which will start the application on port 8080.</p>
</div>

                    </div>
                </td>
                <td id="col2">
            <div class="local clearfix">
                <div class="local-title" style="text-align: right"><a href="https://travis-ci.org/grails-guides/angular2-combined"><img src="https://travis-ci.org/grails-guides/angular2-combined.svg?branch=master" /></a></div>            
                        
                <div class="local-title">
                    <a href="https://github.com/grails-guides/angular2-combined">
                    <svg height="35" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="35" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"/></svg></a> &nbsp;&nbsp;Get the Code
                </div>
                <div class="menu">
                    <div class="input-group">                        
                        <button href="#" onclick="document.getElementById('github-url').value='git@github.com:grails-guides/angular2-combined.git'" class="codeButton">SSH</button>
                        <button onclick="document.getElementById('github-url').value='https://github.com/grails-guides/angular2-combined.git'" class="codeButton">HTTPS</button>
                        <button onclick="document.getElementById('github-url').value='https://github.com/grails-guides/angular2-combined'" class="codeButton">Subversion</button>
                    </div>
       
                    <div class="input-group">                    
                        <!-- Target -->
                        <input id="github-url" value="git@github.com:grails-guides/angular2-combined.git" type="text" />

                        <!-- Trigger -->
                        <button class="clipbtn" type="button" data-clipboard-target="#github-url">

                            <img width="13" src="../img/clippy.svg" alt="Copy to clipboard">
                        </button>       

                    </div>
                    <div class="input-group">
                      <a href="https://github.com/grails-guides/angular2-combined/archive/master.zip" class="downloadButton">Download ZIP</a>
                    </div>
                </div>
                
                <div id="table-of-content">
                    <h2>Table of Contents</h2>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#gettingStarted"><strong>1</strong><span>Getting Started</span></a></div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#requirements"><strong>1.1</strong><span>What you will need</span></a></div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#howto"><strong>1.2</strong><span>How to complete the guide</span></a></div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#writingTheApp"><strong>2</strong><span>Writing the Application</span></a></div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#combining"><strong>2.1</strong><span>Combining the Applications</span></a></div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#build"><strong>2.2</strong><span>Combining the Builds</span></a></div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#configuration"><strong>2.3</strong><span>Changing Configuration</span></a></div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#runningTheApp"><strong>3</strong><span>Running the Application</span></a></div>
                    
                    <div style="clear:both" ></div>
                </div>
                                    
            </div>
        </td>
            </tr>
        </table>

        <div id="footer">
            Copies of this document may be made for your own use and for distribution to others, provided that you do not charge any fee for such copies and further provided that each copy contains this Copyright Notice, whether distributed in print or electronically. All guides are released with an ASLv2 license for the code, and Creative Commons license for the writing. 
            
        </div>


<script type="text/javascript">
    new Clipboard('.clipbtn');
</script>
<script type="text/javascript" src="../js/docs.js"></script>
    </body>
</html>
